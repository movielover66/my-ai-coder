<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Fixer</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background-color: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            margin: 0;
        }
        h2 { color: #61dafb; text-align: center; }
        .container { max-width: 600px; margin: 0 auto; }
        
        textarea {
            width: 100%;
            height: 150px;
            background-color: #2d2d2d;
            color: #fff;
            border: 1px solid #3e3e3e;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            font-size: 14px;
        }
        
        button {
            width: 100%;
            padding: 12px;
            background-color: #0e639c;
            color: white;
            border: none;
            border-radius: 5px;
            margin-top: 10px;
            font-size: 16px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover { background-color: #1177bb; }

        .output-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #252526;
            border-left: 5px solid #61dafb;
            display: none;
        }
        .label { font-weight: bold; color: #ce9178; display: block; margin-bottom: 5px; }
        pre { white-space: pre-wrap; margin: 0; }
    </style>
</head>
<body>

<div class="container">
    <h2>üõ†Ô∏è AI Code Fixer</h2>
    <p>Apnar Script niche paste korun:</p>
    <textarea id="codeInput" placeholder="Example: var x = 10 console.log(x"></textarea>
    
    <button onclick="fixCode()">Check & Fix Code</button>

    <div id="resultArea" class="output-box">
        <span class="label">üîé Analysis & Fix:</span>
        <pre id="outputText">Waiting for AI...</pre>
    </div>
</div>

<script type="module">
    // 1. Google AI Library Import
    import { GoogleGenerativeAI } from "https://esm.run/@google/generative-ai";
    
    // 2. Apnar api.js file theke Key Import kora hochhe
    import { API_KEY } from './api.js';

    // 3. AI Setup
    const genAI = new GoogleGenerativeAI(API_KEY);

    // 4. Main Function (Window object-e add kora holo jate Button kaj kore)
    window.fixCode = async function() {
        const inputCode = document.getElementById("codeInput").value;
        const resultArea = document.getElementById("resultArea");
        const outputText = document.getElementById("outputText");
        const btn = document.querySelector("button");

        if(!inputCode) {
            alert("Doya kore kichu code likhun!");
            return;
        }

        btn.innerText = "Checking...";
        outputText.innerText = "Analyzing code...";
        resultArea.style.display = "block";
        
        try {
            // Model Setup
            const model = genAI.getGenerativeModel({ model: "gemini-pro" });
            
            const prompt = `You are a helpful coding assistant. 
            Review this code:
            "${inputCode}"
            
            1. Find the error.
            2. Explain the error briefly.
            3. Provide the corrected code.
            `;

            const result = await model.generateContent(prompt);
            const response = await result.response;
            const text = response.text();

            outputText.innerText = text;
        } catch (error) {
            // Error Handling
            outputText.innerText = "Error: " + error.toString();
            console.error("Full Error:", error);
        }
        
        btn.innerText = "Check & Fix Code";
    }
</script>

</body>
</html>
